# Cambios Realizados

- Se agregó `PROJECT_CONTEXT.md` con el inventario del stack, estructura de carpetas, comandos de build/test, convenciones y puntos críticos (incluye nota sobre API key expuesta y el import roto en `StockTable.tsx`).
- Se agregó `MEJORAS_A_REALIZAR.md` con el plan priorizado: higiene inicial (API key a `.env`, corrección de import), adopción de React Query con query keys tipados y hooks por dominio, reorganización de API/servicios/tipos, optimizaciones de performance (virtualización, code splitting, memoización, ajustes de Highcharts), mejoras de UX/estados, TS/calidad, testing y documentación/métricas.
- Se reorganizó el enrutado para apuntar a las páginas en `src/components/pages`: `App.tsx` ahora usa `HomePage` y `DetailPage`, y ambas páginas renderizan los componentes actuales (`StockTable` y `Detail`) como contenido principal.
- Se corrigió el import roto en `src/components/StockTable.tsx` para usar la carpeta real `atoms` y evitar fallos de compilación.
- UI mobile: en `src/components/templates/StockTable.tsx` el contenedor scroll ahora ocupa casi todo el alto disponible en móviles (`height: calc(100vh - spacing)`), manteniendo límite de 540px en desktop.
- Gitignore fortalecido para ignorar `.env`, `.env.local`, `dist` y `.DS_Store`; se añadió `.env.example` con las claves `VITE_TWELVE_DATA_API_KEY` y `VITE_TWELVE_DATA_API_URL`.
- Tipos de TwelveData centralizados: `src/types.ts` ahora aliasa a `src/api/types` para `IStock`, `IStockData` y `IValuesStockData`, evitando duplicación y desalineación con las respuestas reales.
- React Query: se centralizaron `queryKeys` (`src/hooks/queries/queryKeys.ts`), se añadió `useStockSearch` con caché corta, la lista de acciones persiste en `localStorage` con `staleTime: Infinity`, se actualizó `useStockList`, `useStockMeta` y `useTimeSeries` a los nuevos keys; la tabla virtual prefetch meta al hover usando `prefetchQuery`.
- Navegación en lista/virtualización: `StockCard` y `StockTableRow` ahora son links a `/stock/:symbol`, manteniendo el prefetch de meta en hover.
- Prefetch extendido: `StockVirtualList` ahora prefetch también la serie temporal por defecto (15min, últimos 2 días) al hover, además del meta.
- Estados de error/loading: `StockTable` muestra alertas de error y estado “actualizando...”; `DetailPage` muestra alertas de error para series.
- Se eliminó el `.env` del repositorio; ahora solo se usa `.env.example` como referencia y `.gitignore` lo protege.
- Mejor fallback de carga para rutas lazy en `src/App.tsx` usando `CircularProgress` y layout centrado.
- Skeletons movidos a `src/components/molecules/skeletons/StockListSkeleton.tsx` y reutilizados en la lista virtual.
- Pantalla de error mejorada en `errorBoundary.tsx` con layout centrado, texto claro y acciones de “Recargar” e “Ir al inicio”.
- Prefetch en hover ahora tiene delay de 250ms en `StockVirtualList` para reducir llamadas al pasar el cursor rápidamente.
- Gráfico optimizado: `StockChart` ahora samplea a 500 puntos máx., usa eje datetime, boost opcional, dataGrouping, tooltip formateado y estado “sin datos”; memoiza la config para evitar recalcular; `DetailPage` muestra indicador “Actualizando…” con chip/spinner, skeleton dedicado para el gráfico y fallback mejorado.
- UI de tipo en listas/cards: `StockTableRow` usa pill coloreada con `getStockTypeMeta` en toda la fila clicable; `StockCard` ahora muestra chip de tipo con los colores del helper.
- Filtros de búsqueda con ícono de lupa (MUI) en `StockFilters` para inputs de nombre y símbolo.
- Botón para limpiar filtros (IconButton con tooltip) agregado a `StockFilters`.
- Layout de tabla: `StockTable` ahora usa `Container` ancho (`maxWidth="xl"`, sin gutters) con padding responsive y `overflowX: hidden` para evitar scroll horizontal interno.
- Testing configurado: se añadieron Vitest + Testing Library, scripts `test`/`test:watch`, setup de jest-dom (`src/test/setupTests.ts`) y utilidades de render (`src/test/testUtils.tsx`).
- Tests añadidos: hooks `useStockList` (mock de servicio, cache) y `useTimeSeries` (parámetros y cache key); componentes `HomePage` (render de encabezados con hooks mockeados) y `DetailPage` (estado loading de meta).
- Fix testing MUI: se agregaron alias de resolución y `deps.inline` para @mui en `vite.config.ts` para evitar errores de import en Vitest.
- Se añadió React Query: dependencias `@tanstack/react-query` y devtools, `QueryClientProvider` envolviendo la app con opciones base (`staleTime`, `gcTime`, `retry`) en `src/main.tsx`, devtools habilitado en desarrollo.
- Nueva capa de API tipada: `src/api/client.ts` (axios + API key desde `VITE_TWELVE_DATA_API_KEY`), `endpoints.ts`, `types.ts`.
- Servicios y hooks de datos: `src/services/stockService.ts` (lista, meta, series); hooks React Query `useStockList`, `useStockMeta`, `useTimeSeries` en `src/hooks/queries/` con keys consistentes y `keepPreviousData` donde aplica.
- `StockTable` ahora consume `useStockList` en lugar de la llamada manual; mantiene filtros/paginación y estados de carga usando `isLoading`.
- `DetailPage` integra React Query para meta y series (`useStockMeta`, `useTimeSeries`), conserva el layout y muestra estados de carga/actualización y errores simples; elimina el componente intermedio `Detail`.
- `StockPreferenceForm` ajustado para usar los nuevos servicios (`fetchTimeSeries`, `fetchStockMeta`) y los átomos desde `components/atoms`.
- Migración UI React Query completada: `StockTable` deriva datos directamente del cache y filtra con `useMemo`, maneja `isError` y reinicia página al cambiar filtros; `DetailPage` usa estados de carga/error de las queries para meta/series sin efectos manuales.
- `StockPreferenceForm` ahora usa hooks React Query (`useStockMeta`, `useTimeSeries` con `refetch` manual) y deshabilita el botón mientras carga; propaga los datos de serie al callback cuando llegan.
- `DetailPage`: se agregó toggle de auto-actualización con `refetchInterval` dinámico según intervalo (1min/5min/15min) y feedback de estado; se mantiene mensaje de error y actualización en segundo plano.
- Lazy loading: `HomePage` y `DetailPage` ahora se cargan con `React.lazy/Suspense`, y el gráfico (`StockChart`) se carga bajo demanda en detalle para reducir el bundle inicial.
- API key a `.env`: `api/client.ts` ahora toma `VITE_TWELVE_DATA_API_KEY` y `VITE_TWELVE_DATA_API_URL` desde variables de entorno (fallback a la URL pública).
- Se revirtió la virtualización del listado: `StockTable` vuelve a tabla/paginación clásica (filtros + `TablePagination`) usando `useStockList` y `TableRow`/`TableHeader`; mobile sigue con cards. `fetchStockList` ahora trae hasta 5000 registros por defecto.
- Dependencias de virtualización alineadas: `react-window@1.8.10` y `@types/react-window@^1.8.8` instaladas.
